# いちばんやさしいLinuxコマンド入門教室
## 1. Linux操作の基本
### 1-1. Linuxの基本
- Linux：Unix系オペレーティングシステムカーネル
  - カーネル(Kernel)：OSの中核部分
  - Linux ＝ Linus + UNIX
  - ディストリビューション(Distribution)：Linuxカーネルを使用し、製品にまとめたもの
  - OSS(Open Source Softwear)
- ディストリビューション
  - Debian GNU/Linux：Ubuntuの大元
  - Ubuntu：デスクトップ版／サーバー版
  - Raspbian：Debianをラズパイ用に改版
  - Red Hat Enterprise Linux：企業サーバー、有償
  - CentOS：RHEL互換
  - Fedra：RHELの実験版的位置づけ
- GUIとCUI
  - GUI(Graphical User Interface)
  - CUI(Charactor User Interface)、CLI(Command Line Interface)
    - 慣れたら素早く操作できる
    - 遠隔操作が簡単にできる
    - 汎用性がある
    - 自動化しやすい
- Linuxのプロンプト
  - user_name@host_name: ~/current_dir$
    - $：一般ユーザー
    - #：管理者ユーザー
- Linuxのコマンド
  - コマンド [オプション] [引数]
  - ヘルプ：コマンド --help、コマンド-h
  - マニュアル：man コマンド
- Linuxのディレクトリ
  - / （ルート）
    - bin        ：一般ユーザーが実行できる基本コマンドが格納される
    - boot       ：システムの起動に必要なファイルが格納される
    - dev        ：各種のデバイスを表す特殊ファイルが格納される
    - etc        ：システム設定ファイルが格納される
    - home       ：ユーザーのホームディレクトリが格納される
    - lib        ：ライブラリファイルが格納される
    - lost+found ：破損したファイルが格納される（通常は空）
    - media      ：DVDなどの外部メディアがマウントされる
    - proc       ：プロセス情報が格納される
    - root       ：rootユーザーのホームディレクトリ
    - sbin       ：システム管理用の基本コマンドが格納される
    - tmp        ：一時的なファイル置き場
    - usr        ：各種コマンド、プログラム、ライブラリ、ドキュメントが格納される
    - var        ：ログファイルなど更新されるファイルが格納される
- Linuxのユーザー
  - root：システムの最高管理者
  - システムユーザー：システムプログラムを動かす
  - 一般ユーザー：システム利用者
- Linuxのグループ
  - 複数のユーザーをまとめて、権限を管理できる
- パーミッション(Permisson)：アクセス権
  - 読み取り
  - 書き込み
  - 実行

## 2. ファイル操作
### 2-1. ファイルの基本操作
- カレントディレクトリを表示する<br>
```
pwd
``` 
- カレントディレクトリを変更する
```
cd [-] [変更先ディレクトリ]
cd、cd ~ ：ホームディレクトリに戻る
cd - ：直前のディレクトリに戻る
cd .. ：1階層上に移動
```
- ファイルやディレクトリの一覧を表示する
```
ls 
ls -l：詳細を表示
```
- ファイルの種類を確認する
```
file ファイル名
```
- テキストファイルの内容を表示する
```
cat [ファイル名]
```
- 長いファイルの内容を表示する
```
less [ファイル名]
```
  - ↑↓：スクロール
  - スペース、F：次ページ、B：前ページ
  - G：最初のページ、Shif+G：最後のページ

### 2-2. ファイルのコピーと削除
- ファイルをコピーする
```
cp コピー元ファイル コピー先ファイル：別名で保存
cp コピー元ファイル コピー先ディレクトリ名：同名で別ディレクトリにコピー
```
- ファイルを移動する
```
mv 移動元ファイル名 移動先ディレクトリ名
```
- ファイル名を変更する
```
mv 元ファイル名 変更後ファイル名
```
- ファイルを削除する
```
rm 削除ファイル名
rm -i 削除ファイル名：確認表示
```

### 2-3． ディレクトリの基本操作
- ディレクトリを作成する
```
mkdir [-p] ディレクト名
-p：複数階層を一度に作成する
```
- ディレクトリをコピーする
```
cp -r コピー元ディレクトリ コピー先ディレクトリ
```
- ディレクトリを移動する
```
mv 移動元ディレクトリ名 移動先ディレクトリ名
```
- ディレクトリを削除する
```
rm -r[f] ディレクトリ名
-rf：確認なしで一気に削除
```
- ディレクトリの容量を確認する
```
du [オプション] [ディレクトリ名]
du -h ディレクトリ名：読みやすい単位で表示
```

### 2-4. ファイルのパーミッション
- ファイルのパーミッションを確認する
```
ls -l
```
  - rw-r--r--：所有者、グループ、その他ユーザー
  - r：読み取り可能
  - w：書き込み権
  - x：実行権
  - 数値でも表せる（2進数）
    - 777：rwxrwxrwx：フルアクセス
    - 755：rwxr-xr-x
    - 664：rw-rw-r--
    - 644：rw-r--r--
    - 600：rw-------
    - 000：---------：アクセス不可
- ファイルのパーミッションを変更する
```
chmod アクセス権 ファイルまたはディレクトリ
```
  - 所有者、rootユーザーのみ
  - アクセス権：数値指定が一般的
  - アクセス権記号
    - 対象
      - u：所有者
      - g：所有グループ
      - o：その他のユーザー
      - a：全てのユーザー
    - 権限操作
      - +：アクセス権追加
      - -：アクセス権削除
      - =：アクセス権指定
    - アクセス権
      - r：読み取り可能
      - w：書き込み可能
      - x：実行可能
- 所有者を変更する
```
sudo chwon [-R] 所有者 ファイルまたはディレクトリ
-R：ディレクトリの中身も同時に設定
```
  - rootユーザーのみ
- 所有グループを変更する
```
sudo chgrp [-R] 所有グループ ファイルまたはディレクトリ
```
  - rootユーザーのみ

## 3. シェルと日常作業コマンド
### 3-1. シェルの機能を活用しよう
- シェル(shell)の役割：入力したコマンドに対応したプログラムを実行
- シェルの種類
  - bash：多くのLinuxディストリビューションやmacOSで標準的に使用されている
  - sh：30年以上前のUNIX時代から使われている
  - dash：Ubuntuでshの代用として使われている
  - ksh：shの改良型
  - csh：shの改良型（C言語のような文法）
  - tcsh：cshの改良型
  - zsh：bash、kshの機能を大幅に強化した多機能シェル
  - fish：最近になって作られたバランスの良いシェル
- キー操作
  - ←→：左右移動（ctrl+B、ctrl+F）
  - ctrl+A：行頭移動、ctrl+E：行末移動
  - ctrl+U：行頭まで削除、ctrl+K：行末まで削除
  - ctrl+L：画面クリア
- 過去に実行したコマンドを再実行する
```
history [オプション]
!履歴番号：実行
```
  - ↑↓キーでもコマンドライン上に呼び出せる
- コマンドや引数を補完する
  - TABキーで補完が可能
  - 候補が複数ある場合は、2回押すと一覧が表示
- 直前の引数を再利用する
  - ESCキー => .キー
- メタキャラクタを使う
  - *：任意の文字 => *.txt
  - ?：任意の1文字
  - [abc]：a,b,cのいづれか1文字
  - [^abc]：a,b,c以外の1文字

### 3-2. シェルの環境を設定する
- 文字列を表示する
```
echo "文字列"
echo '文字列'
echo '”文字列” 文字列'
```
- 変数を使う
```
echo $変数名  変数参照
変数名=値     変数名変更
```
  - HOME：ユーザーのホームディレクトリのパス
  - LANG：ユーザーの言語・地域情報
  - PATH：コマンドを検索するディレクトリ
  - PS1：プロンプトの書式
  - HISTSIZE：保存するコマンドの履歴数
  - HISTFILESIZE：ファイルに保存するコマンドの履歴数
- Linuxのコマンド
  - 組み込みコマンド(bash)
    - alias：エイリアスの作成・表示
    - echo：引数の内容を表示する
    - exit：シェルを終了する
    - export：環境変数を設定する
    - history：コマンド履歴を表示する
    - pwd：カレントディレクトリのパスを表示する
    - unalias：エイリアスを削除する
  - 外部コマンド
- コマンドの確認
```
type コマンド
```
  - 組み込み：builtin
  - 外部：格納場所
- コマンドサーチパス
```
echo $PATH
```
  - コマンドをサーチするPATHの一覧
- 変数
  - シェル変数：シェル上で設定した変数
  - 環境変数(大文字)：定義されたシェル、新しいシェルやプログラムで共通
- 環境変数の設定
```
export 変数名     値の参照
export 変数名=値  値の変更
```
- シェルの環境を確認する
```
cat ~/.profile  
cat ~/.bashrc   
```

### 3-3. エイリアス機能を使いこなそう
- エイリアスの一覧表示
```
alias
```
- エイリアスの設定
```
alias エイリアス名='コマンド'
```

### 3-4. 管理者(root)権限でコマンドを実行する
- sudoを使って管理者権限でコマンドを事項
```
sudo 管理者コマンド
```
- 一時的にrootユーザーに切り替える
```
sudo -s root権限でシェルを新規に起動 => exitで抜ける
```

## 4. テキスト処理コマンド
### 4-1. パイプとリダイレクトを使ってみよう
- 標準入出力
  - 標準入力（デフォルト：キーボード）
  - 標準出力（デフォルト：端末（仮面））
  - 標準エラー出力（デフォルト：端末（仮面））
- リダイレクト：実行結果をファイルに保存する
```
コマンド > ファイル名
```
- 実行結果をファイルに追記する
```
コマンド >> ファイル名
```
- エラーだけを切り分ける
```
コマンド 2> ファイル名
コマンド > ファイル名 2> エラーファイル名
```
- パイプ（パイプライン）を使ってコマンドを連携する<br>
あるコマンドの実行結果を別のコマンドで処理することができる
```
コマンド1 | コマンド2
```
- テキストファイルの先頭だけを表示する
```
head [-行数] [ファイル名]   行数：デフォルトは10行
ls -l /etc | head -5
```
- テキストファイルの末尾だけを表示する
```
tail [-行数] [ファイル名]   行数：デフォルトは10行
ls -l /etc | tail -5
```
- テキストファイルの行数を数える
```
wc [オプション] [ファイル名]    行数 単語数 バイト数
wc -l   行数のみ
ls | wc -l    ファイル数を数える
```
- テキストファイル内の文字列を検索する
```
grep [オプション] 文字列パターン [検索対象ファイル]
grep http /etc/services     httpにマッチ
grep -n http /etc/services  -nで行番号も表示
grep -i http /etc/services  -iで大文字、小文字を区別しない
grep -ni http /etc/services  -nと-iを同時指定
```
- 正規表現を使って検索する
```
grep -n ^# /etc/services     #で始まる
grep -n ^$ /etc/services     空行
egrep "(SSL|TLS)" /etc/services   SSL、TLSのどちらかを含む
```

### 4-3. テキストファイルを編集する
- nanoエディターを使う
```
nano
nano ファイル名 ：起動後にctrl+Rでも読み込み可能
```
  - ctrl+W  ：文字検索
  - Alt+^   ：カーソル行をコピー
  - ctrl+K  ：カーソル行をカット
  - ctrl+U  ：ペースト
  - ctrl+X  ：エディター終了
  - ctrl+G  ：ヘルプ表示
  - ctrl+A  ：行頭へ移動
  - ctrl+E  ：行末へ移動
  - ctrl+Y  ：前ページへ移動
  - ctrl+V  ：次ページへ移動
  - Alt+\   ：ファイルの先頭に移動
  - Alt+/   ：ファイルの行末に移動
  - ctrl+C  ：メッセージ行に表示
  - ctrl+L  ：画面リフレッシュ

### 4-4. ファイルを検索する
- ファイル名で検索する
```
locate ファイル名
locate ファイル名 | grep キーワード 
```
- ディレクトリを指定して検索する
```
find 検索ディレクトリ -name "ファイル名"
find . -name "*.txt"
```
- ファイル名以外の条件で検索する
```
find 検索ディレクトリ -条件 値
find . -atime +10   10日以上更新されていないファイル
```
  - size  ：サイズ
  - atime ：最終アクセス日
  - amin  ：最終アクセスを分単位で指定
  - mtime ：最終更新日
  - type f：ファイルのみ
  - type d：ディレクトリのみ
  - prem  ：アクセス権

### 4-5. ファイルを圧縮・解凍する
- 圧縮の形式
  - gzip形式  .gz Linuxでは一般的
  - bzip2形式  .bz2 gzipより圧縮率が高い
  - xz形式  .xz 最近利用が増えている形式
  - zip形式 .zip  Win、Macで利用されている形式
- ファイルの圧縮
```
gzip [-k] 圧縮するファイル名
bzip2 [-k] 圧縮するファイル名
xz [-k] 圧縮するファイル名
zip 圧縮ファイル名 圧縮するファイル名
```
- ファイルの解凍
```
gunzip 圧縮ファイル名
bunzip2 圧縮ファイル名
unxz 圧縮ファイル名
unzip 圧縮ファイル名
```
- ファイルをまとめてアーカイブする
```
tar オプション [ディレクトリ名]
tar -czf アーカイブファイル名 圧縮したいディレクトリ  ：圧縮＋アーカイブ
tar -xzf アーカイブファイル名                         ：解凍＋展開
```
  - -c：アーカイブ作成
  - -x：アーカイブ展開
  - -f ファイル名：アーカイブファイル名を指定
  - -z：gzip、gunzipを使用
  - -j：bzip2、bunzip2を使用
  - -J：xz、unxzを使用

## 5. パッケージ管理をする
### 5-1. ソフトウェアは「パッケージ」単位で管理する
- パッケージ：ソフトウェアを管理する単位
  - 実行ファイル（ソフトウェア本体）
  - ライブラリ（プログラムの部品）
  - 設定ファイル
  - ドキュメント（マニュアルなど）
- パッケージ管理システム<br>
リポジトリからパッケージとパッケージ情報をやりとりする<br>
依存関係を自動で解決<br>
  - APT：Debian系 ←Ubuntu
  - YUM：RHEL系 ←CentOS

### 5-2. aptコマンドによるパッケージ管理
- はじめにインデックスを更新する
```
sudo apt update
apt list --upgradable
```
  - インデックス：ソフトウェアの索引のようなもの
- aptでシステムをアップデートする
```
sudo apt upgrade
```
- aptでパッケージをインストールする
```
sudo apt install パッケージ名
```
- aptでパッケージを削除する
```
sudo apt remove パッケージ名
```
- aptでパッケージ情報を検索する
```
apt search キーワード
```
- aptでパッケージ情報を表示する
```
apt show パッケージ名
```
- aptでインストール済みパッケージを確認する
```
apt list --installed
```

### 5-3. yumコマンドによるパッケージ管理
- yumでシステムをアップデートする
```
sudo yum update
```
- yumでパッケージをインストールする
```
sudo yum install パッケージ名
```
- yumでパッケージを削除する
```
sudo yum remove パッケージ名
```
- yumでパッケージ情報を検索する
```
yum search キーワード
```
- yumでパッケージ情報を表示する
```
yum info キーワード
```
- yumでインストール済みパッケージを確認する
```
yum list installed
```

## 6. ネットワークコマンド
### 6-1. ネットワークの状況を確認する
- 自ホストのIPアドレスを調べる
```
ip address show
ip a  （省略形）
ifconfig  ：見やすいが標準でインストールされていないことも
```
- ネットワークやホストが動作しているか確認する
```
ping [オプション] ホスト名またはIPアドレス
ping -c 4 127.0.0.1
```
- ネットワークサービスを確認する
```
ss [オプション]
ss -lt  ：TCPポートのネットワークサービスを確認
ss -lt  ：UDPポートのネットワークサービスを確認
```

### 6-2. ネットワーククライアントコマンドを使う
- URLを指定してファイルをダウンロードする
```
wget [オプション] ダウンロードするファイルのURL
wget -o ファイル名 ダウンロードするファイルのURL  ：ファイル名変更
wget -q ダウンロードするファイルのURL ：DLメッセージなし
```
```
curl [オプション] ダウンロードするファイルのURL
curlは、多くのプロトコルに対応している
```
- ホスト名からIPアドレスを調べる
```
host ホスト名
```
- ドメイン情報を調べる
```
whois ドメイン名
sudo apt install whoisでインストール
```

### 6-3. SSHで安全に接続する
- SSH(Secure SHell)でリモートホストにログインする
```
ssh [ユーザー名@]接続先ホスト
```
- ホスト認証とユーザー認証
  - ホスト認証：接続元ホストが接続先ホストを確認
  - 接続先がユーザーを確認
- SSHでファイルをコピーする
```
scp [-r] コピー元 コピー先
コピー元、コピー先：[[ユーザー名@]ホスト:][ファイルのパス]
```
- SSHのログインを公開鍵認証にする
  - 公開鍵
  - 秘密鍵
- 公開鍵ペアを作成する
```
ssh-keygen -t 暗号の種類（RSAで良い）
パスフレーズを設定する => 秘密鍵を開くため
```
- 公開鍵を接続先ホストに登録する
```
ssh-copy-id [ユーザー名@]接続先ホスト
```
- 手動での公開鍵登録
  - scpで公開鍵を接続先ホストにコピー
  - 公開鍵ファイルの内容を「~/.ssh/authorized_keys」ファイルに追記
- パスワード認証の禁止
  - /rtc/ssh/sshd_configを開く
  - #PasswordAuthentication yes → no
  - 再起動：sudo systemctl restart sshd

## 7. システム管理コマンド
### 7-1. ぜひとも知っておきたいシステム管理コマンド
- システムをシャットダウンする
```
sudo shutdown -h いつ
sudo shutdown -h now/+10/22:00 
```
- システムを再起動する
```
sudo shutdown -r いつ
sudo shutdown -r now/+10/22:00 
```
- ディスクの使用状況を確認する
```
df [オプション]
df -H   ：見やすい単位で表示
```
- システム（CPU）の負荷を確認する
```
uptime
```

### 7-2. プロセスとハードウェアを管理する
- プロセスの一覧を表示する
```
ps [オプション]
ps aux  ：システム全体
```
- プロセスやシステムの状態を監視する
```
top
```
- 指定したプロセスを終了させる
```
kill [-シグナル] PID
```
- OSを確認する
```
uname -a    ：システム情報を表示
lsb_release -a    ：ディストリビューション情報を表示
```
- ハードウェア構成を確認する
```
cat /proc/cpuinfo     ：CPU情報
lspci                 ：PCIバス接続機器情報
lsusb                 ：USB接続機器情報
```

### 7-3. ユーザーとグループを管理する
- ユーザーを作成する
```
sudo adduser ユーザー名
```
- パスワードを変更する
```
passwd                  ：自分のパスワード
sudo passwd ユーザー名  ：他のユーザーのパスワード
```
- パスワードを生成する
```
pwgen 12 3    ：12桁のパスワードを3個作成
```
- ユーザーを削除する
```
sudo userdel [-r] ユーザー名
```
- グループの管理
```
sudo groupadd グループ名  ：グループの作成
sudo usermod -G グループ名 ユーザー名  ：グループへユーザーの追加
groups ユーザー名   ：所属グループの確認
```
- ユーザーやグループの一覧を表示する
```
getent passwdまたはgroup
```

## 8. 補足
### 8-1. デバイスファイル
- デバイスファイル：/dev
- デバイスファイルとマウントポイントの確認
```
lsblk
```
- マウントコマンド
```
mount デバイスファイル名 マウントポイント
```
- マウント解除
```
ummount デバイスファイル名またはマウントポイント
```