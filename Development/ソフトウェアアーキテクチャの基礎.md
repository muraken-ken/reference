# ソフトウェアアーキテクチャの基礎
## 1章 イントロダクション
### 1.1 ソフトウェアアーキテクチャの定義  
#### ■ ソフトウェアアーキテクチャを定義する4つの側面
1. システムの構造
1. アーキテクチャ特性
1. アーキテクチャ決定：システムをどのように構築すべきかのルール
1. 設計指針：ガイドライン（望ましいアプローチ）

#### ■ アーキテクトへの8つの期待
1. アーキテクチャ決定を下す
1. アーキテクチャを継続的に分析する
1. 最新のトレンドを把握し続ける
1. 決定の順守を徹底する
1. さまざまなものに触れ、経験している
1. 事業ドメインの知識を持っている
1. 対人スキルを持ち合わせている
1. 政治を理解し、かじ取りをする

#### ■ アーキテクチャの法則
  1. 第一の法則：ソフトウェアアーキテクチャはトレードオフがすべてだ
  1. 第二の法則：「どうやって」よりも「なぜ」の方がずっと重要だ

## 2章 アーキテクチャ思考
### 2.1 アーキテクチャと設計
#### ■ 従来のモデル：機能しない  
＜アーキテクト＞ → アーキテクチャ特性／スタイル／コンポーネント構造  
↓  
＜設計者＞ → クラス設計／UI／ソースコード    

#### ■ 機能するモデル  
アーキテクチャ特性／スタイル／コンポーネント構造 ← ＜アーキテクト＞ ←→ ＜設計者＞ → クラス設計／UI／ソースコード  

### 2.2 技術的な幅
#### ■ 知識の三角形
  1. わかっていること
  1. わかっていないとわかっていること
  1. わかっていないとわかっていないこと

#### ■ アーキテクトと開発者
  - トレードオフを分析する → 知識の深さより幅が重要

## 3章 モジュール性
### 3.2 モジュール性の計測
#### ■ コナーセンス
システムの全体的な正しさを維持するため、あるコンポーネントの変更が別のコンポーネントの変更を必要とする場合、2つのコンポーネントはコナーセント（接続）されている  
1. 静的コナーセンス（コードレベルでの結合）
  - 名前のコナーセンス（Connascence of Name:CoN）
  - 型のコナーセンス（Connascence of Type:CoT）
  - 意味のコナーセンス（Connascence of Meaning:CoM）
  - 位置のコナーセンス（Connascence of position:CoP）
  - アルゴリズムのコナーセンス（Connascence of Algorithm:CoA）
2. 動的コナーセンス（実行時の呼び出し）
  - 実行順序のコナーセンス（Connascence of Execution:CoE）
  - タイミングのコナーセンス（Connascence of Timing:CoT）
  - 値のコナーセンス（Connascence of Values:CoV）
  - アイデンティティーのコナーセンス（Connascence of Identity:CoI）  

※動的コナーセンスより、静的コナーセンスの方が望ましい

## 4章 アーキテクチャ特性
### 4.1 アーキテクチャ特性の（部分的な）リスト
#### ■ アーキテクチャ特性 3つの基準
1. ドメインに依らない、設計に関する考慮事項を明らかにするもの
1. 設計の構造的な側面に影響を与えるもの
1. アプリケーションの成功に不可欠か重要なもの

#### 4.1.1 アーキテクチャの運用特性
|用語|定義|
|---|---|
|可用性(Availability)|システムの利用期間|
|継続性(Continuity)|障害復旧能力|
|パフォーマsンス(Performance)|ストレステスト、ピーク分析、使用頻度、容量、応答時間など|
|回復性(Recoverablility)|処理の特性要件|
|信頼性(Reliability)／安全性(Safty)|フェイルセーフ、障害時の損失、影響範囲|
|堅牢性(Robustness)|障害時にエラーや境界条件を処理できるか|
|スケーラビリティ(Scalability)|ユーザー数、リクエスト数|

#### 4.1.2 アーキテクチャの構造特性
|用語|定義|
|---|---|
|構成容易性(Configurability)|エンドユーザーがソフトウェア設定を簡単に変更できること|
|拡張性(Extensibility)|新しい機能をプラグインで追加することの重要性|
|インストール容易性(Installability)|インストールの容易さ|
|活性性(Leverageability)／再利用性(Reuse)|複数の製品でコンポーネントを利用できること|
|ローカライゼーション(Localization)|タ言語対応の要件|
|メンテナンス容易性(Maintainability)|変更の運用、システムの拡張の容易さ|
|可搬性(Portability)|システムが複数のプラットフォームで動作する必要があるか|
|アップグレード容易性(Upgradeability)|アップグレードを簡単に行える能力|

#### 4.1.3 アーキテクチャの横断的特性
|用語|定義|
|---|---|
|アクセシビリティ(Accessibility)|すべてのユーザーのアクセスしやすさ|
|長期保存法(Archivability)|データの保存期間、方法|
|認証(Authenticaton)|セキュリティ要件|
|認可(Authorization)|セキュリティ要件|
|合法性(Legal)|法的制約|
|プライバシー(Privacy)|取引を隠せるか|
|セキュリティ(Security)|データ、通信の暗号化、リモートアクセス|
|サポート容易性(Supportability)|技術サポート要件|
|ユーザビリティ(Usability)／達成容易性(Achievability)|トレーニングのレベル|

#### 4.2 トレードオフと少なくとも最悪でないアーキテクチャ
※最善のアーキテクチャを狙ってはいけない。最悪でないアーキテクチャを狙おう。

## 5章 アーキテクチャ特性を明らかにする
### 5.1 アーキテクチャ特性をドメインの関心事から捉える
|ドメインの関心事|アーキテクチャ特性|
|---|---|
|合併・買収|相互運用性、スケーラビリティ、適応性、拡張性|
|市場投入までの時間|アジリティ、テスト容易性、デプロイ容易性|
|ユーザー満足度|パフォーマンス、可用性、耐障害性、テスト容易性、デプロイ容易性、アジリティ、セキュリティ|
|競争優位性|アジリティ、テスト容易性、デプロイ容易性、スケーラビリティ、可用性、耐障害性|
|時間と予算|シンプルさ、フィジビリティ|

※アーキテクチャ特性は、絞り込み、優先順位をつける

## 6章 アーキテクチャ特性の計測と統制
### 6.2 統制と適応度関数
#### アーキテクチャ適応度関数  
- あるアーキテクチャ特性または、アーキテクチャ特性の組み合わせについて、客観的な整合性評価を行うための何らかの仕組み

## 7章 アーキテクチャ特性のスコープ
### 7.2 アーキテクチャ量子と粒度
#### ■ アーキテクチャ量子
- 高度な機能的凝集性と同期的なコナーセンスを持つ、独立してデプロイ可能なアーティファクト
  - 独立してデプロイ可能
  - 高度な機能的凝集性
  - 同期的なコナーセンス

## 8章 コンポーネントベース思考
### ■ コンウェイの法則  
システムを設計する組織は、そのコミュニケーション構造をそっくりまねた構造の設計を生み出してしまう。

### ■ 分轄
- ドメインによる分割（ドメイン駆動開発）
- 技術による分割

### 8.4　コンポーネントを識別する流れ
1. 初期コンポーネントを識別する
1. コンポーネントに要件を割り当てる
1. ロールや責務を分析する
1. アーキテクチャ特性を分析する
1. コンポーネントを再構成する

### 8.8 アーキテクチャ量子再び：モノリシックアーキテクチャと分散アーキテクチャの選択

## 9章 基礎
### 9.1 基礎的なパターン
1. 巨大な泥団子（いきあたりばったり）
1. ユニタリーアーキテクチャ（PCと一体）
1. クライアント／サーバー（分離）
### 9.2モノリシックアーキテクチャと分散アーキテクチャ
1. モノリシックアーキテクチャ
1. 分散アーキテクチャ
    - 誤信1：ネットワークは信頼できる
    - 誤信2：レイテンシーがゼロ
    - 誤信3：帯域幅は無限
    - 誤信4：ネットワークは安全
    - 誤信5：トポロジーは決して変化しない
    - 誤信6：管理者は一人だけ
    - 誤信7：転送コストはゼロ
    - 誤信8：ネットワークは均一

## 10章 レイヤードアーキテクチャ
### 10.5 このアーキテクチャスタイルを採用する理由
- 小規模でシンプルなアプリケーション、Webサイト
- 予算と時間の制約に強い
- 大規模になると保守性、アジリティ、テスト容易性、デプロイ容易性が悪化

## 11章 パイプラインアーキテクチャ
### 11.2 事例
- 特にシンプルな一方通行処理を進めるタスクで用いられる

## 12章 マイクロカーネルアーキテクチャ
### 12.4 事例とユースケース
- コアシステム + プラグインコンポーネント
- IDEなどのツール類
- 税務申告書作成など（地域などで変わるアプリ）

## 13章 サービスベースアーキテクチャ
- 分散型のマクロなレイヤード構造
- 個別にデプロイされたUI + 個別にデプロイされたサービス + モノリシックなDB
- 最も実用的

## 14章 イベント駆動アーキテクチャ
- 分散非同期型のアーキテクチャスタイル

## 15章 スペースベースアーキテクチャ
- Webサーバー（複数）+ アプリケーションサーバー（複数） + データベース（複数）
- 高いスケーラビリティ、弾力性、高い同時実効性
- チケットサイト、オークションサイトなど

## 16章 オーケストレーション駆動サービス指向アーキテクチャ
- コンピューティングリソースが希少な頃の産物、現在では不要
- 再利用が主メリット
- 不要な結合が増加 → デメリット    16.1　歴史と哲学

## 17章 マイクロサービスアーキテクチャ
- 近年人気
- ドメイン駆動開発の影響を受けている
- 分散アーキテクチャ
- サービスを横断したトランザクションは（例外を除いて）、間違いが生じている

## アーキテクチャ特性
|アーキテクチャ特性|レイヤード|パイプライン|マイクロカーネル|サービスベース|イベント駆動|スペースベース|オーケストレーション駆動サービス指向|マイクロサービス|
|---|---|---|---|---|---|---|---|---|
|分轄タイプ|技術|技術|ドメインと技術|ドメイン|技術|ドメインと技術|技術|ドメイン|
|量子数|1|1|1|1以上|1以上|1以上|1|1以上|
|デプロイ容易性|★|★★|★★★|★★★★|★★★|★★★|★|★★★★|
|弾力性|★|★|★|★★|★★★|★★★★★|★★★|★★★★★|
|進化性|★|★★★|★★★|★★★|★★★★★|★★★|★|★★★★★|
|耐障害性|★|★|★|★★★★|★★★★★|★★★|★★★|★★★★|
|モジュール性|★|★★★|★★★|★★★★|★★★★|★★★|★★★|★★★★★|
|全体的なコスト|★★★★★|★★★★★|★★★★★|★★★★|★★★|★★|★|★|
|パフォーマンス|★★|★★|★★★|★★★|★★★★★|★★★★★|★★|★★|
|信頼性|★★★|★★★|★★★|★★★★|★★★|★★★★|★★|★★★★|
|スケーラビリティ|★|★|★|★★★|★★★★★|★★★★★|★★★★|★★★★★|
|シンプルさ|★★★★★|★★★★★|★★★★|★★★|★|★|★|★|
|テスト容易性|★★|★★★|★★★|★★★★|★★|★|★|★★★★|

## 18章 適切なアーキテクチャスタイルを選ぶ
### 18.1 アーキテクチャにおけるトレンドの変遷
- 過去からの経緯
- エコシステムの変化
- 新しい能力
- 加速
- ドメインの変化
- 技術の変化
- 外部要因

### 18.2 判断基準
- ドメイン
- 構造に影響を与えるアーキテクチャ特性
- データアーキテクチャ
- 組織的な要因
- プロセス、チーム、および運用上の関心事に関する知識
- ドメイン／アーキテクチャの同型性
- モノリスか分散か
- データをどこに置くべきか？
- サービス間の通信スタイルは、同期型か非同期型か

## 19章 アーキテクチャ決定
### 19.1 アーキテクチャ決定に関するアンチパターン
1. 資産防御アンチパターン：決定先延ばし
1. グラウンドホッグデーアンチパターン：決定理由がわからない
1. メール駆動アーキテクチャアンチパターン：メールでの伝達は避ける

### 19.3 アーキテクチャデシジョンレコード(Architecture Decision Records, ADR)
- タイトル：簡単な説明
- ステータス：提案済み／承認済み／破棄
- コンテキスト：状況
- 決定：決定とその根拠
- 影響
- コンプライアンス
- 備考
- 保存はWikiなどが良い

## 20章 アーキテクチャ上のリスクを分析する
### 20.1 リスクマトリックス
|影響度／発生率|低|中|高|
|---|---|---|---|
|低|1|2|3|
|中|2|4|6|
|高|3|6|9|

### 20.2 リスクアセスメント
|リスク基準|処理|処理|リスク合計|
|---|---|---|---|
|スケーラビリティ|2|6|8|
|可用性|3|4|7|
|パフォーマンス|4|2|6|
|セキュリティ|6|3|9|
|データ完全性|9|6|15|
|リスク合計|24|21||

### 20.3 リスクストーミング
1. 特定
1. 合意
1. 軽減

### 21章 アーキテクチャの図解やプレゼンテーション
#### 21.1 図解
- 標準ダイアグラム：UML、C4、ArchiMate

#### 21.2 プレゼンテーション
- スキルが大事

## 22章 効果的なチームにする
### アーキテクトのパーソナリティ
1. コントロールフリーク：束縛
1. アームチェアアーキテクト：放任
1. 効果的なアーキテクト

## 23章 交渉とリーダーシップのスキル
### 23.1 交渉とファシリテーション
### 23.2 リーダーとしてのソフトウェアアーキテクト

## 24章 キャリアパスを開く
### 24.1　20分ルール
- 毎朝20分：新しいことに取り組む

### 24.2 パーソナルレーダーの開発
### 24.3 ソーシャルメディアの使用
### 24.4 別れの挨拶