#  絵でわかるネットワーク
## 1. プロトコルのしくみ
### 1-1. プロトコル
- プロトコル：通信規約
通信するために必要な決まりごと

### 1-2. OSI参照モデル
- OSI参照モデル
  - 第7層：アプリケーション層
  - 第6層：プレゼンテーション層
  - 第5層：セッション層
  - 第4層：トランスポート層
  - 第3層：ネットワーク層
  - 第2層：データリンク層
  - 第1層：物理層

- 第1層：物理層<br>
物理的にコンピュータ同士を接続する「モノ」についての定義

- 第2層：データリンク層<br>
隣り合ったコンピュータ同士でデータをやり取りする方法を定義

- 第3層：ネットワーク層<br>
違うネットワークにあるコンピュータと通信する方法を定義

- 第4層：トランスポート層<br>
通信品質について管理するための階層

- 第5層：セッション層<br>
通信の開始～終了までを管理する階層（全二重通信／半二重通信など含む）

- 第6層：プレゼンテーション層<br>
データの形式を定めるための階層

- 第7層：アプリケーション層<br>
最終的に実現したい機能を定めている階層

- 下位層／上位層
  - 下位層：1～4層<br>
  コンピュータ同士をいかに繋ぐかという役割のプロトコルの集まり
  - 上位層：5～7層<br>
  つながったネットワーク上でどんなやり取りをするか決めたプロトコルの集まり

### 1-3. 回線交換と蓄積交換
- 回線交換方式<br>
  - 通信品質が良い：回線が占有される（電話）
  - コストが高い：多くの人が通信する場合、回線数を増やす必要がある
- 蓄積交換方式<br>
  - コストが低い：パケット単位での通信、パケット ＝ ヘッダ（宛先）＋データ
  - 異種機間接続：異なるプロトコルでも変換可能
  - 通信を切断せずに経路制御が可能
  - 即時性（リアルタイム性）、速度で劣る

### 1-4. コネクション型通信とコネクションレス型通信
- コネクションレス型通信<br>
速度が必要な通信に向く：ヘッダ小さい、ブロードキャスト（同報通信）
- コネクション型通信<br>
通信品質が高い：届いたかの確認を行う

### 1-5. WANとLAN
- WAN(Wide Area Network)：大規模ネットワーク（公衆ネットワーク）
- MAN(Metropolitan Area Network)：中規模ネットワーク
- LAN(Local Area Network)：小規模ネットワーク（私的ネットワーク）

## 2. IPアドレスとMACアドレス
### 2-1. 通信とアドレス
- アドレス
  - 宛先として必須
  - アドレスの一意性が大事
### 2-2. IPアドレス
- IPアドレス
  - 世界レベルの一意性
  - 処理のしやすさ
  - ICANN => JPNIC で管理

- UNC(Uniform Naming Convention：汎用命名規則)
  - Windowsのコンピュータ名

- IPアドレス：11000000 10101000 00000000 00000001
- IPアドレス：192.168.0.1

### 2-3. ネットワークアドレスとホストアドレス
- アドレスの階層化：2段階の階層<br>
ネットワークを大きくし過ぎない工夫
  - ネットワークアドレス：ネットワーク自体のアドレス
  - ホストアドレス：各コンピュータ、通信機器

### 2-4. サブネットマスク
- サブネットマスク（可変長サブネットマスク）<br>
階層を区切る場所を任意に選べるようにする技術
  - クラスA：255.0.0.0
  - クラスB：255.255.0.0
  - クラスC：255.255.255.0
  - 任意：255.255.255.224
  - 任意：192.168.0.1/27

### 2-5. IPアドレス以前のネットワークの状態
- イーサネット(Ethernet)：物理接続で普及率の高い規格
- MACアドレス（物理アドレス）：イーサネットで使用するアドレス<br>
    - 48桁：24桁（製造メーカー）＋24桁（一意な番号）
    - NIC(Network Infomation Card)に固有の番号
    - 変更不可

### 2-6. ARP(Address Resolution Protocol)
IPアドレスからイーサネットのMACアドレスの情報を得られるプロトコル

### 2-7. ブリッジによる分割
- CSMA／CD方式(Carrier Sense Multiple Access/Collision Detection)<br>
回線の空きを確認 => 送信 => もし衝突したら => 再送 という仕組み<br>
輻輳：ネットワークが込むと何度も衝突を繰り返し、再送を繰り返す<br>
対策：ブリッジでコリジョンドメイン（衝突検知範囲）を分割する<br>
現在：上記のブリッジはほとんど使用されていない

- スイッチングハブ（スイッチ）<br>
現在の主流：ブリッジを組み合わせコリジョンドメインを2台とする<br>
衝突なし ＝ スイッチングハブ ＋ 通信経路の全二重化

- リピータハブとスイッチングハブの違い
  - リピータハブ：全ての端末に信号を中継、安価、衝突あり、電力少
  - スイッチングハブ：MACアドレスで宛先の端末のみに中継、高価、電力大

### 2-8. ルータによる分割
- ブリッジ：MACアドレスによる分割
- ルータ：IPアドレスによる分割
  - デフォルトゲートウェイ：ネットワークをまたいだ通信につかう中継ルータ
- パケット作成
  - データ分割（フラグメンテーション）
  - IPヘッダ追加 => IPパケット
  - イーサネットヘッダ追加 => イーサネットフレーム
  - 受取りは逆の順番で行う

## 3. ポート番号のしくみ
### 3-1. コンピュータ内での通信
- IPアドレスはコンピュータ単位の宛先 => コンピュータはマルチタスク
### 3-2. ポート番号
- ポート番号：プログラムごとに割り当てられた一意な番号
  - 2進数16桁：65536のアドレス
  - コンピュータ内のプログラムを識別
### 3-3. Well Knownポート
- ポート番号：基本的に任意
  - OSが自動割り当て：ダイナミックポート、エフェメラルポート
- Well Knownポート：予約されたポート、サーバー等で使用、0～1023
  - 80：Hypertext Transfer Protocol (HTTP)
  - 443：Hypertext Transfer Protocol over TLS/SSL (HTTPS)
  - 25：Simple Mail Transfer Protocol (SMTP)
  - 465：Message Submission over TLS protocol (SMTPS)
  - 587：e-mail message submission (SMTP)
  - 110：Post Office Protocol v3 (POP3)
  - 995：Post Office Protocol 3 over TLS/SSL (POP3S)
  - 143：Internet Message Access Protocol (IMAP)
  - 993：Internet Message Access Protocol over TLS/SSL (IMAPS)
  - 20：FTP - データ転送ポート
  - 21：FTP - コントロールポート
  - 53：Domain Name System (DNS)
- 使用しない場合はポートは閉じておく
### 3-4. UDP(User Datagram Protocol)
- UDP<br>
通信品質の保証はせず、リアルタイム性を重視した通信
  - コネクションレス通信
  - ヘッダ情報が小さい（送信元ポート、送信先ポート、パケット長、チェックサム）
### 3-4. TCP(Transmission Control Protocol)
- TCP<br>
通信品質の保証を行う通信、ポピュラー
  - 通信の始めと終わりに3ウェイハンドシェイク
    - SYN（通信を開始して良い？） =>
    - <= ACK（OK）＋ SYN（通信を開始して良い？）
    - ACK（OK） =>
    - 終了時はSYN => FIN
  - データ転送時の確認応答
    - シーケンス番号
    - ACK番号
    - 上記により、パケットの喪失を知り、再送等を行う
### 3-5. TCPを高速化する方法
- スライディングウインドウ方式<br>
ACKを待たずに1度に送っても良いデータ量（ウィンドウ）をACKごとにずらす
  - 高速再送制御：完全に受信したパケットに対するACKを返し続ける
    - 受信失敗：同じACKが返ることで再送
    - ACK抜け：先のACKが返っていれば、再送不要
### 3-6. フロー制御
- スロースタート<br>
最初はウインドウサイズを小さく => 徐々に大きく<br>
PCの能力なども調整できる

## 4. ネットワークの距離の考え方
### 4-1. ルーティング
- ルーティングテーブル（経路表）
  - ルーティング：最適な方向にパケットを送り出す
  - ルーティングの要素
    - ホップ数：ルータ（ネットワークの数）
### 4-2. ルーティングテーブル
- ルーティングテーブルの中身
  - 宛先ネットーワーク
  - サブネットマスク
  - 次に行くべきルータ
  - 出口NIC
  - メトリック：ホップ数など
  - ルータにもデフォルトゲートウェイがある<br>
  次の行先が不明の場合、とりあえず渡す<br>
  TTL(Time To Live：生存時間)：を超えたバケットは消える
### 4-3. ルーティングプロトコル
- スタティックルーティング（静的経路制御）<br>
人が作成したルーティングテーブルで動作（最近は使われない）
- ダイナミックルーティング（動的経路制御）<br>
最適な経路をルータに自動で計算させる方法
  - ディスタンスベクタ型<br>
  方向（ベクトル）、距離（ディスタンス）の情報を交換しながら経路を決定する方式<br>
  欠点：ルータの処理能力が低いなど速くない経路を選択する可能性がある
  - リンクステート型<br>
  他のルータとリンクに関する情報を共有して経路計算を行う<br>
  ネットワーク構成を単純化したトポロジ（接続形態）情報を蓄積する<br>
  ディスタンスベクタ型の欠点を補う
- RIP(ルーティング・インフォメーション・プロトコル) <br>
ディスタンスベクタ型で最もポピュラー<br>
アドバタイズ（広告）で情報を30秒ごとに更新する
- OSPF（オープン・ショーテスト・パス・ファースト）<br>
リンクステート型の代表的な技術<br>
距離に通信速度も含めたコストという概念を導入<br>
やりとりする情報が多い => 細かく分けてやり取り
  - Helloパケット：データ交換の可否を確認
  - データベース記述パケット：情報の要約
  - リンク状況要求パケット：必要なトポロジ情報の要求
  - リンク状態更新パケット：詳細なトポロジ情報の送信
### 4-4. プライベートアドレス
- IPアドレス
  - IPv4：32桁アドレス 枯渇問題
  - IPv6：128桁アドレス 共存しつつ移行中
- プライベートアドレス
  - IPアドレスの再利用
  - イントラネット内でのみ使用
  - 利用可能アドレス
    - クラスA用：10.0.0.0 ～ 10.255.255.255
    - クラスB用：172.16.0.0 ～ 172.31.255.255
    - クラスC用：192.168.0.0 ～ 192.168.255.255
### 4-5. プライベートアドレスの活用
- NAT(ネットワーク・アドレス・トランスレーション)<br>
プライベートアドレス <=> グローバルアドレスを貸出し <=> インターネット<br>
弱点：アドレスチェックが正しく働かない
- IPマスカレード(NAPT：Network Address and Port Translation)<br>
最も普及している技術、単にNATでもこちらを指す<br>
1つのグローバルアドレスを使用し、複数のコンピュータを通信できる<br>
ポート番号も併用してアドレス変換を行う<br>

## 5. ファイアウォールのしくみ
### 5-1. フィルタリング
- 性善説：あっという間にセキュリティインシデント
- ネットワーク不使用：イソターネット、安全だが不便でもある
- フィルタリング：選択的に接続を許可する
### 5-2. ファイアフォール
フィルタリングを専門に行う機器
- インバウンドトラフィック：ネットワークに入ってくる通信
- アウトバウンドトラフィック：ネットワークを出ていく通信
- フィルタリングルール
  - ブラックリスト方式：通過させない通信のみ
  - ホワイトリスト方式：通化させる通信のみ、リスクが小さい
### 5-3. トラフィック制御の仕方
- IPアドレスでのフィルタリング
  - パケットフィルタリング型：特定のIPアドレスのみ監視
  - トランスポートゲートウェイ型：ポート番号も併用、かなり高いセキュリティレベルが実現可能
  - アプリケーションゲートウェイ型：検査データ量大、速度遅い、安全性高い
### 5-4. ウイルス対策ソフト
- コンピュータウイルス（マルウェア）
  - 感染する
  - 潜伏する
  - 発病する
- ウイルス対策ソフト
  - パターンファイルで検査
  - 事後 => リアルタイム検索
### 5-5. DMZ(DeMilitarized Zone)
- 第三のゾーン：サーバを立てる時など<br>
ファイアウォール1とファイアウォール2の間でDMZを構築
## 6. DNSとDHCP
### 6-1. DNS(Domain Name System)
- ドメイン名：IPアドレスにつける別名
  - FQDN(Fully Qualified Domain Name)：完全修飾ドメイン名
  - 名前解決：ドメイン名をIPアドレスに変換する
- DNSサーバ：名前解決専用のサーバ
  - リゾルバ：PCのDNSクライアント
  - 最寄りのDNSサーバ => ルートDNSサーバ => TLD DNSサーバ => SLD DNSサーバ => TLD DNSサーバ
  - DNSラウンドロビン：問い合わせ毎に違うIPアドレスを回答（分散させる）
### 6-2. DHCP(Dynamic Host Configuration Protocol)
- DHCP：自動でIPアドレスを割り当てる
### 6-3. ゲートウェイ
- ゲートウェイ：異なるプロトコル同士の通信を変換する
## 7. 無線LANとWi-Fi
### 7-1. 無線LAN
- 無線LAN規格
  - IEEE802.11  2Mbps 2.4GHz
  - IEEE802.11a 54Mbps 5GHz
  - IEEE802.11b 11Mbps 2.4GHz
  - IEEE802.11g 54Mbps 2.4GHz
  - IEEE802.11n 600Mbps 2.4GHz/5GHz Wi-Fi4
  - IEEE802.11ac 6.9Gbps 5GHz Wi-Fi5
  - IEEE802.11ax 9.6Gbps 2.4GHz/5GHz Wi-Fi6 
- 後方互換性：旧規格の機器もつながる（ただし通信速度は遅くなる）
- Wi-Fi：Wi-Fi Allianceによる接続認証制度 => 通信規格の番号
- 通信モード
  - インフラストラクチャモード：アクセスポイントとやりとり
  - アドホックモード：直接通信（Wi-Fi Direct）
- SSID(Service Set IDentifier)：無線LAN識別子
  - ベーシックSSID（MACアドレス）
  - 拡張SSID(Extended SSID)：名前が変えられる
  - ステルスモード：ビーコンにSSIDを使用しない
### 7-2. CSMA/CA
- CSMA/CA(Carrier Sence Multiple Access / Collision Avoidance)<br>
衝突を回避する仕組みが導入されている
  - RTS(Request To Send)：リクエストをAPに送る
  - CTS(Clear To Send)：通信可能を端末に送る
  - ACK：通信確認信号
- 通信速度についての注意
  - 無線LANは理論値ほど速度はでない
  - bpsのb：ビット => ファイルの容量はバイト（1バイト＝8ビット）
### 7-3. 無線LANのセキュリティ
- 通信の暗号化
  - WEP RC4
  - WPA TKIP（RC4をベースに鍵が変化する）
  - WPA2 CCMP（AESベース）
  - WPA3 CCMP
- 認証方法（WPA/WPA2/WPA3）
  - パーソナルモード：共通のパスフレーズを使用
  - エンタープライズモード：端末ごとのパスフレーズ、デジタル証明書、IEEE802.1X
- IEEE802.1X
  - サプリカント：クライアント
  - オーセンティケータ：アクセスポイント
  - 認証サーバ
- データオフロード(Data-off-load)<br>
スマホの通信をWi-Fiに振り分けるなど、リソースの有効活用
## 8. クラウドのしくみ
### 8-1. クラウドはどこにあるのか
- オンプレミス：構内システム
- スタンドアローン
  - スケールアップ：性能の良いPCに変更する
  - スケールアウト：コンピュータの台数を増やす
- クライアント／サーバモデル（役割分担）<br>
サーバが処理をすることでクライアントは性能が低くても大丈夫
- サーバ群の設置
  - ハウジング：自社のコンピュータ設備を整備の行き届いた環境に預ける
  - ホスティング：コンピュータも含め業者がデータセンターを用意する
  - 仮想化：1台のPCで何台もの仮想マシンを動かす
- クラウド<br>
  - ホスティングに近い
  - 超大規模
  - 一般にも公開
  - 機器の制約が少ない
  - シンクライアント／ファットクライアント論争は継続中
### 8-2. クラウドの分類
- コンピュータの構造
  - ハードウェア
  - 基本ソフト（OS：オペレーティングシステム）
  - 応用ソフト（アプリケーションソフト）
- IaaS(Infrastructure as a Service)：ハードウェアを貸すサービス
- Paas(Platform as a Service)：OS、実行環境までを貸すサービス
- PaaS(Software as a Service)：ソフトウェアまでを貸すサービス
- パブリッククラウドとプライベートクラウド
  - プライベート：企業向け専用クラウドなど
    - 閉域IP網
    - VPN（仮想専用線）