# 楽々ERDレッスン

## 第1部 DB設計総論

### 第1章 手順としての正規化
- DB設計の要点：「One Fact in One Place」<br>
  => 実現する手段：正規化
- 本書での正規化のポイント
  1. IDの導入
  2. 業務の視点からの正規化

#### IDの導入
- レコードの存在を表現する識別子：ID
- ID(Identifier)を用意することで、洗い替え問題などがおこらない
- IDはC言語のポインタのようなもの

#### 業務視点での正規化
- 価格：顧客毎、契約毎、割引など様々なケースがある<br>
  => 顧客にしっかりヒアリング、ビジネスを理解することが必要

#### ERDについて
- ERD：Entity Relationship Diagrum (ER図)
  1. IE記法
  2. IDEF1X記法

### 第2章 DB設計の基礎知識

#### DB設計の悩み
- 経験が積みづらい
- DB設計が定まらないとプログラム設計が確定しない
- DBの影響範囲が広く、容易に変更できない
- バックアップなどの管理領域にも影響する
- DBへのアクセス→性能のボトルネックになりやすい
- セキュリティ、問題発生時のデータメンテナンスにも影響する

#### DB設計のポイント
- エンティティ(箱)の見出し方
- 主キーの設定
- 重複の排除(正規化)

##### エンティティ(箱)の見出し方

エンティティの候補は6W3Hで整理する<br>
エンティティ  6W3H<br>
- リソース系<br>
  誰に  Whom<br>
  誰が  Who<br>
  何を  What<br>
  どこ  Where<br>
- イベント系<br>
  どのように  How<br>
- 属性の候補<br>
  いつ  When<br>
  どれくらい  How many<br>
  いくら  How much<br>
- いわゆるビジネス上の正規化の対象となるもの  Why

積極的に業務要件を拾い、分類に困ったものは一番に合いそうなエンティティに放り込む<br>
=>「必要な項目が存在しない」は気づきにくい

##### 主キーの設定
- キーの種類
  1. 主キー(Primary Key)
  2. ユニークキー(Unique Key)
  3. 候補キー
  4. 外部キー(Foreign Key)

- ○○コードは「あだ名」=> 識別はIDを利用
  1. コード洗い替え問題
  2. 諸口問題(その他)
  3. 履歴=>開始日、終了日
  4. m:m問題=>中間マップで変換

##### 重複の排除(正規化)
- ヘッダ・ディティール関係(見出し・明細形式)
- 状態遷移=>シンプルにその状態を切り出す
- デリベーションルール=>「可逆性」を有した状態に留めておく

#### DB設計の手順
1. ブロック分け
2. イベント系エンティティの抽出
3. イベント系エンティティの正規化
4. リソース系エンティティの分類を整理
5. ブロック間でのリソースの統合
6. 導出系の整理

---

## 第2部 RDBMS総論

### 第1章 RDBMSの必要性を考える

#### メリット
- 標準化されたSQLの存在
- 物理情報と論理情報の分離
- データ整合性保持の容易性確保
- 複数ユーザによる同時利用の実現

### 第2章 経営資産の視点に基づくDB設計
- 数学的正規化 => 業務的正規化
- 論理設計と物理設計 => HW高性能化、インデックス設計、IDの活用で論理設計を活かす

### 第3章 資産活用としてのSQL
- SQLはバッチ処理
- ストアドプロシージャの利用
- クラスとエンティティの粒度は違う

---

## 第4部 RDBMS総論

### 第1章 SQLのからくり

#### SQL文の書き方
1. 作業の宣言
```
select
;
```
2. 取り出すテーブルの確定
```
select
from テーブル名
;
```
3. レコードを特定
```
select
from テーブル名
where
  レコード名 = 条件
;
```
4. グループ分け
```
select
from テーブル名
where
  レコード名 = 条件
group by
    レコード名
;
```
5. グループ分けする列名を選択リストに入れる
```
select
  レコード名
from テーブル名
where
  レコード名 = 条件
group by
    レコード名
;
```
6. グループ毎の集合関数を指定
```
select
  レコード名
  ,count( )
from テーブル名
where
  レコード名 = 条件
group by
    レコード名
;
```
7. 集合関数の列名を指定
```
select
  レコード名
  ,count( * )
from テーブル名
where
  レコード名 = 条件
group by
    レコード名
;
```
8. Having句とその条件を記述
```
select
  レコード名
  ,count( * )
from テーブル名
where
  レコード名 = 条件
group by
    レコード名
having
  count(*) >= 5
;
```

### 第2章 RDBMSのボトルネックの原因と対策
- 何度もRDBMSに接続しにいくのを避ける
- 同じデータを何度も検索するのを避ける
- 同じディスクに集中するのを分散する
- 1台のCPUに集中するのを分散する
